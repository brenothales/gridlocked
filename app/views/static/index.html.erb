<script src = "https://maps.googleapis.com/maps/api/js?sensor=false"></script>
<% if current_user %>
	<% if !@posts.blank? %>
		<script>
			function initialize() {
				if (navigator.geolocation) {
					navigator.geolocation.getCurrentPosition(showPosition);
				} else {
					alert("Geolocation is not working");
				}
			}
			function showPosition(position) {
				var locations = new Array();
				<%= render partial: "posts/post", collection: @posts %>


				var map = new google.maps.Map(document.getElementById('map-canvas'), {
					zoom: 15,
					center: new google.maps.LatLng(position.coords.latitude, position.coords.longitude),
					mapTypeId: google.maps.MapTypeId.ROADMAP
				});

				var infowindow = new google.maps.InfoWindow();

				var marker, i;

				for (i = 0; i < locations.length; i++) {  
					marker = new google.maps.Marker({
						position: new google.maps.LatLng(locations[i][1], locations[i][2]),
						map: map,
						maxWidth: 1000 
					});

					google.maps.event.addListener(marker, 'click', (function(marker, i) {
						return function() {
							infowindow.setContent(locations[i][0]);
							infowindow.open(map, marker);
						}
					})(marker, i));
				}

			}
			google.maps.event.addDomListener(window, 'load', initialize);
		</script>
	<% else %>
		<h4>No one is complaining. <%= link_to "Click here to start voicing some opinions", new_post_path %></h4>
	<% end %>
	<div id="map-container">
		<div id="map-canvas" style="width:100%;height: 500px;"></div>
	</div>
<% else %>
	<h1>Static#index</h1>
	<p>Find me in app/views/static/index.html.erb</p>
<% end %>